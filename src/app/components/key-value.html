<ng-container
  [formGroup]="keyValueForm">

  <div 
    [ngStyle]="{'grid-template-columns': 'repeat(auto-fit, ' + columnWidth + ')'}"
    class="keyValues">

    <div
      *ngFor="let keyValue of keyValueForm.controls.keyValues['controls']; let ix = index"
      class="keyValue">

      <lintel-input
        [formControl]="keyValue['controls'][0]"
        *ngIf="!keyConstraints"
        class="key">
      </lintel-input>

      <lintel-singleselector
        [formControl]="keyValue['controls'][0]"
        [options]="keyConstraints"
        *ngIf="!!keyConstraints"
        class="key"
        placeholder=" ">
      </lintel-singleselector>

      <div
        class="separator">
        :
      </div>

      <lintel-input
        [formControl]="keyValue['controls'][1]"
        *ngIf="!valueConstraints"
        class="value">

        <ng-container
          *ngTemplateOutlet="suffixTemplate">
        </ng-container>

      </lintel-input>

      <lintel-singleselector
        [formControl]="keyValue['controls'][1]"
        [options]="valueConstraints"
        *ngIf="!!valueConstraints"
        class="value"
        placeholder=" ">

        <ng-container
          *ngTemplateOutlet="suffixTemplate">
        </ng-container>

      </lintel-singleselector>

      <!-- NOTE: common suffix for different value controls -->

      <ng-template
        #suffixTemplate>

        <fa-icon 
          (click)="removeKeyValue(ix)"
          [icon]="['fas', 'times']"
          *ngIf="keyValueForm.controls.keyValues['controls'].length > 1"
          suffix
          title="Remove this item">
        </fa-icon>

        <a
          (click)="addKeyValue()"
          *ngIf="ix === keyValueForm.controls.keyValues['controls'].length - 1"
          suffix>
          More
        </a>

      </ng-template>

    </div>

  </div>

</ng-container>
